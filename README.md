# Calibre-Web 书籍管理系统

这是一个基于Node.js和Express的Calibre书籍管理系统的Web界面，允许用户浏览和搜索Calibre数据库中的书籍。

## 功能特点

- 美观的书籍展示界面
- 多种排序方式：时间、书名、作者、出版日期
- 无限滚动加载更多书籍
- 搜索功能
- 分类浏览：作者、出版社、分类、丛书等
- 响应式设计，适配各种设备
- 每日自动清理缩略图缓存

## 安装和使用

### 前提条件

- Node.js (v12.0.0或更高版本)
- npm (v6.0.0或更高版本)
- 已有的Calibre书籍库和metadata.db文件

### 安装步骤

1. 克隆或下载本仓库
2. 安装依赖：
   ```
   npm install express sqlite3 cors sharp node-schedule
   ```
3. 配置Calibre数据库路径：
   - 编辑`config.js`文件
   - 设置`calibreDbPath`为你的Calibre数据库文件(metadata.db)的路径
   - 可以使用相对路径或绝对路径

### 启动服务器

```
node server.js
```

默认情况下，服务器将在http://localhost:4545上运行。你可以在`config.js`中修改端口号。

## 使用说明

### 浏览书籍

- 主页显示所有书籍
- 使用左侧导航栏切换不同的视图：
  - 书籍：显示所有书籍
  - 发现：随机排序的书籍
  - 分类：按标签分类的书籍
  - 丛书：按系列分组的书籍
  - 作者：按作者分组的书籍
  - 出版社：按出版社分组的书籍
  - 语言：按语言分组的书籍

### 排序选项

顶部的排序按钮允许你按不同的方式排序书籍：
- 时间顺序正序/倒序
- 名称顺序/倒序
- 作者顺序/倒序
- 出版日期顺序/倒序

### 分页

- 页面会自动加载更多书籍，当你滚动到页面底部时
- URL会自动更新为当前页码，例如`/books/page/2`
- 你可以直接访问特定页面，例如`/books/page/3`

### 搜索

使用顶部的搜索框搜索书籍。搜索将匹配书名、作者和出版社。

## 配置选项

在`config.js`文件中可以配置以下选项：

- `port`: 服务器端口号（默认：4545）
- `calibreDbPath`: Calibre数据库文件路径
- `enableCors`: 是否启用CORS（默认：true）

## 技术栈

- 后端：Node.js, Express, SQLite3
- 前端：HTML, CSS, JavaScript (原生)
- 数据库：Calibre的SQLite数据库

## 注意事项

- 本应用仅读取Calibre数据库，不会修改任何数据
- 确保应用有权限访问指定的Calibre数据库文件和书籍目录
- 默认端口为4545，可在config.js中修改
- 封面图片直接从Calibre书籍目录中读取，确保路径正确

## 自定义

### 数据库路径
在`config.js`文件中修改`calibreDbPath`设置，指向您的Calibre数据库文件。

### 端口设置
在`config.js`文件中修改`port`设置，更改应用的监听端口。

### 每页显示数量
默认每页显示20本书籍，如需修改，请在index.html文件中搜索`booksPerPage`变量并修改其值。

### 显示更多元数据
如果需要显示更多的书籍元数据，可以修改server.js中的SQL查询语句，添加所需的字段。

## 性能优化

本应用采用了以下性能优化措施：

1. **分页加载**：默认每页只加载20本书籍，避免一次性加载所有数据
2. **延迟搜索**：输入搜索关键词时，会延迟500毫秒再执行搜索，避免频繁请求
3. **图片懒加载**：封面图片会在需要时才加载，减少初始加载时间
4. **错误处理**：当封面图片不存在时，会显示占位符，避免破坏页面布局

## 自动化功能

### 定时清理缩略图

系统设置了自动清理缩略图的定时任务：
- 每天凌晨3点自动清理所有缩略图
- 清理后的缩略图会在用户访问时按需重新生成
- 这有助于确保缩略图始终是最新的，并防止缩略图目录过大

如需修改定时任务的执行时间，请编辑server.js文件中的以下代码：
```javascript
// 设置定时任务 - 默认每天凌晨3点执行
const dailyJob = schedule.scheduleJob('0 3 * * *', function() {
  // 任务代码
});
```

cron表达式格式为：`秒 分 时 日 月 星期`，例如：
- `0 3 * * *` - 每天凌晨3点
- `0 0 * * *` - 每天午夜0点
- `0 0 1 * *` - 每月1日午夜0点

## 常见问题

### 无法连接到数据库
- 检查`config.js`中的路径设置是否正确
- 确保应用有权限访问该文件
- 确保路径中使用了正确的斜杠（Windows系统建议使用`/`而非`\`）

### 封面图片无法显示
- 确保Calibre库的路径正确
- 检查书籍目录中是否存在cover.jpg文件
- 确保应用有权限访问书籍目录

## 许可证

MIT